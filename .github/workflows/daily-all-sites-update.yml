name: Daily Research Gatherer (No API Costs)

on:
  schedule:
    - cron: '0 15 * * *'  # 10:00 AM ET
  workflow_dispatch:

permissions:
  contents: write

jobs:
  gather-research:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: pip install requests beautifulsoup4 lxml

      - name: Create pending_content directory
        run: mkdir -p pending_content

      # Sports Betting Prime - Consensus and Hub updates (these work independently)
      - name: Update Sports Betting Prime
        env:
          ODDS_API_KEY: ${{ secrets.ODDS_API_KEY }}
        run: |
          echo "=== SPORTS BETTING PRIME ==="
          python scripts/github_consensus_update.py || true

      # LOLSBA Research Gathering
      - name: Gather LOLSBA Research
        run: |
          echo "=== LOLSBA RESEARCH ==="
          python scripts/generate_lolsba.py
          echo "Research saved - Claude Code will process into elite article"

      # MLB Research Gathering (for all 3 MLB sites)
      - name: Gather MLB Research
        run: |
          echo "=== MLB RESEARCH ==="
          python scripts/generate_mlb_news.py
          echo "Research saved - Claude Code will create unique articles for each MLB site"

      # Balls Deep Research Gathering
      - name: Gather Balls Deep Research
        run: |
          echo "=== BALLS DEEP RESEARCH ==="
          python scripts/generate_ballsdeep.py
          echo "Research saved - Claude Code will write satire article"

      # ChatGPT Disaster Research Gathering
      - name: Gather ChatGPT Disaster Research
        run: |
          echo "=== CHATGPT DISASTER RESEARCH ==="
          python scripts/generate_chatgptdisaster.py
          echo "Research saved - Claude Code will write tech journalism"

      # Real AI Girls Research Gathering
      - name: Gather Real AI Girls Research
        run: |
          echo "=== REAL AI GIRLS RESEARCH ==="
          python scripts/generate_realaigirls.py
          echo "Research saved - Claude Code will write blog post"

      # Copy research files from /tmp to pending_content
      - name: Collect Research Files
        run: |
          DATE_STR=$(date +%Y-%m-%d)
          cp /tmp/lolsba_research_${DATE_STR}.json pending_content/ || true
          cp /tmp/mlb_research_${DATE_STR}.json pending_content/ || true
          cp /tmp/ballsdeep_research_${DATE_STR}.json pending_content/ || true
          cp /tmp/chatgptdisaster_research_${DATE_STR}.json pending_content/ || true
          cp /tmp/realaigirls_research_${DATE_STR}.json pending_content/ || true
          echo "Research files collected:"
          ls -la pending_content/

      # Commit & Push research files
      - name: Commit Research Files
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git add pending_content/
          git diff --staged --quiet || git commit -m "Daily research gathered $(date +'%Y-%m-%d') - run /daily-content to process"
          git push || true

      - name: Summary
        run: |
          echo "## Daily Research Gathered - Ready for Processing" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Research Files Created:" >> $GITHUB_STEP_SUMMARY
          echo "- LOLSBA: SBA/PPP fraud news research" >> $GITHUB_STEP_SUMMARY
          echo "- MLB (x3 sites): MLB news and transactions" >> $GITHUB_STEP_SUMMARY
          echo "- Balls Deep: Sports scores and satire angles" >> $GITHUB_STEP_SUMMARY
          echo "- ChatGPT Disaster: AI failure news" >> $GITHUB_STEP_SUMMARY
          echo "- Real AI Girls: AI art news" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Next Steps:" >> $GITHUB_STEP_SUMMARY
          echo "1. Open Claude Code" >> $GITHUB_STEP_SUMMARY
          echo "2. Run: git pull (to get research files)" >> $GITHUB_STEP_SUMMARY
          echo "3. Run: /daily-content" >> $GITHUB_STEP_SUMMARY
          echo "4. Claude Code writes elite articles from research" >> $GITHUB_STEP_SUMMARY
          echo "5. Articles uploaded to all sites" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**NO API COSTS - Research gathering is FREE**" >> $GITHUB_STEP_SUMMARY
